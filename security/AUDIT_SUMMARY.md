# Security Audit Summary

Date: 2026-03-01

Summary:
- Performed Python dependency audit (`pip-audit`) and npm dependency audit (`npm audit`).
- Performed a repo secret scan for obvious API keys and tokens.

Findings:
- Python (pip-audit): found 9 known issues across several packages. Notable advisories:
  - `flask` (CVE-2026-27205) — upgrade to `>=3.1.3` where applicable.
  - `flask-cors` (multiple advisories) — upgrade to `>=4.0.2` or `6.0.0` depending on compatibility.
  - `marshmallow` (CVE-2025-68480) — DOS via `load(..., many=True)`; upgrade to `>=3.26.2` or `4.1.2`.
  - `werkzeug` (CVE-2026-27199) — upgrade to `>=3.1.6`.
  - Note: installing pinned older/newer packages created `httpx` version conflicts with other `supabase`-related packages; upgrades must be tested.

- npm (`npm audit`): reported 1 high-severity issue (minimatch ReDoS). `npm ci` failed because `package-lock.json` is out-of-sync; lockfile must be regenerated with `npm install` before full remediation.

- Secrets found in repository (these are sensitive and should be removed/rotated immediately):
  - `backend/.env` contains `SUPABASE_SERVICE_KEY`, `OPENAI_API_KEY`, `OPENROUTE_API_KEY`, `PERPLEXITY_API_KEY` (remove file from repo, rotate keys).
  - `frontend_config_Version2.js`, `frontend/config.local.js`, and `frontend/config.*` contain exposed OpenRouter/OpenRoute keys.
  - Tests and docs reference placeholder/test keys — confirm none are real before keeping them.

Immediate recommended actions (short-term):
1. Remove `backend/.env` and other files with real secrets from git history and replace with env var placeholders. Rotate any leaked secrets immediately (Supabase service key, OpenAI/OpenRouter keys, Perplexity key).
2. Regenerate `package-lock.json` by running `npm install` locally, then run `npm audit` and apply fixes (or update transitive dependencies) and commit updated lock.
3. Create a test branch and upgrade the flagged Python packages to their fixed versions, run the full test suite, and resolve any compatibility issues (particularly `httpx` vs `supabase` packages).
4. For `marshmallow` DOS advisory, audit code paths that call `schema.load(..., many=True)` and add defensive validation or upgrade as recommended.
5. Add automated checks to CI (the repository now contains `.github/workflows/security-audit.yml`) — extend to fail PRs on critical vulnerabilities and optionally create Dependabot security PRs.
6. Add secret-scanning to CI (e.g., GitHub Advanced Security or a pre-commit hook using `detect-secrets`) and ensure `.env` is in `.gitignore` (it already is) and remove any committed secrets from history.

Next steps (I'll proceed if you confirm):
- Open a branch `security/remediate` and implement the minimal safe upgrades for Python and npm packages, run tests, and prepare PR with changes.
- Remove committed secret files from the repo and prepare a secret-rotation checklist.

Command snippets used / to run locally:
```bash
# Activate venv (Windows PowerShell)
& .venv\Scripts\Activate.ps1
python -m pip install --upgrade pip
python -m pip install -r backend/requirements.txt
python -m pip install pip-audit
pip-audit --format json

# Node/npm (regenerate lock then audit)
npm install
npm audit --audit-level=high --json
```

Report generated by automation on repo. If you want, I can open a remediation branch and start applying safe upgrades and prepare PRs. Reply with `go ahead` and I'll proceed.
